CREATE DATABASE sistema;
USE sistema;

-- Tabela de Formas de Pagamento
CREATE TABLE FormasPagamento (
    Id INT PRIMARY KEY AUTO_INCREMENT,
    Descricao VARCHAR(100) NOT NULL, 
    Ativo BIT DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabela de Condições de Pagamento
CREATE TABLE CondicoesPagamento (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Descricao VARCHAR(100) NOT NULL,
    QtdParcelas INT NOT NULL,
    Juros DECIMAL(5,2) DEFAULT 0.00,
    Multa DECIMAL(5,2) DEFAULT 0.00,
    Desconto DECIMAL(5,2) DEFAULT 0.00,
    Ativo BIT DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Tabela de Parcelamento
CREATE TABLE Parcelamentos (
    NumeroParcela INT NOT NULL,
    CondicaoPagamentoId INT NOT NULL,
    FormaPagamentoId INT NOT NULL,
    PrazoDias INT NOT NULL,
    PorcentagemValor DECIMAL(5,2) NOT NULL,
    PRIMARY KEY (NumeroParcela, CondicaoPagamentoId),
    FOREIGN KEY (CondicaoPagamentoId) REFERENCES CondicoesPagamento(Id) ON DELETE CASCADE,
    FOREIGN KEY (FormaPagamentoId) REFERENCES FormasPagamento(Id) ON DELETE CASCADE
);

-- Tabela de Países
CREATE TABLE Paises (
    Id INT PRIMARY KEY AUTO_INCREMENT,
    Pais VARCHAR(100),
    Sigla VARCHAR(3) UNIQUE,
    DDI VARCHAR(5),
    Moeda VARCHAR(5),
    Ativo BIT DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);


-- Tabela de Estados
CREATE TABLE Estados (
    Id INT PRIMARY KEY AUTO_INCREMENT,
    Estado VARCHAR(100),
    UF VARCHAR(5),
    PaisId INT,
    Ativo BIT DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (PaisId) REFERENCES Paises(Id)
);


-- Tabela de Cidades
CREATE TABLE Cidades (
    Id INT PRIMARY KEY AUTO_INCREMENT,
    Cidade VARCHAR(100),
    EstadoId INT,
    DDD VARCHAR(4), 
    Ativo BIT DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (EstadoId) REFERENCES Estados(Id)
);


-- Tabela de Clientes
CREATE TABLE Clientes (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Ativo BIT NOT NULL DEFAULT 1,
    Cliente VARCHAR(100) NOT NULL,
    CpfCnpj VARCHAR(18) UNIQUE NOT NULL,
    Rg VARCHAR(20),
    Telefone VARCHAR(20),
    Email VARCHAR(100),
    Endereco VARCHAR(200),
    NumeroEndereco INT,
    Bairro VARCHAR(100),
    Complemento VARCHAR(200),
    Cep VARCHAR(10),
    CidadeId INT, 
    IdCondicaoPagamento INT,
    Tipo VARCHAR(10) NOT NULL,
    Genero CHAR(1),
    DataNascimento DATE,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UsuarioModificacao VARCHAR(100) DEFAULT 'sistema',
    FOREIGN KEY (CidadeId) REFERENCES Cidades(Id) ON DELETE SET NULL,
    FOREIGN KEY (IdCondicaoPagamento) REFERENCES CondicoesPagamento(Id) ON DELETE SET NULL
);


-- Tabela de Funcionários
CREATE TABLE Funcionarios (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Funcionario VARCHAR(100) NOT NULL,
    CpfCnpj VARCHAR(18) UNIQUE NOT NULL,
    Rg VARCHAR(20),
    Telefone VARCHAR(20),
    Email VARCHAR(100),
    Endereco VARCHAR(200),
    Cep VARCHAR(10),
    Cargo VARCHAR(50),
    Salario DECIMAL(10,2),
    CidadeId INT, 
    Tipo VARCHAR(10) NOT NULL,
    Bairro VARCHAR(100),
    NumeroEndereco INT,
    Complemento VARCHAR(200),
    DataAdmissao DATE DEFAULT NULL,
    DataDemissao DATE DEFAULT NULL,
    DataNascimento DATE DEFAULT NULL,
    Ativo BIT NOT NULL DEFAULT 1,
    Apelido VARCHAR(50),
    Genero CHAR(1),
    Matricula VARCHAR(20),
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (CidadeId) REFERENCES Cidades(Id) ON DELETE SET NULL 
);

-- Tabela de Fornecedores
CREATE TABLE Fornecedores (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Fornecedor VARCHAR(100) NOT NULL,
    CpfCnpj VARCHAR(18) UNIQUE NOT NULL,
    Telefone VARCHAR(20),
    Email VARCHAR(100),
    Endereco VARCHAR(200),
    Cep VARCHAR(10),
    Tipo VARCHAR(10) NOT NULL,
    Bairro VARCHAR(100),
    NumeroEndereco INT,
    Complemento VARCHAR(200),
    CidadeId INT, 
    InscricaoEstadual VARCHAR(30),
    InscricaoEstadualSubtrib VARCHAR(30),
    IdCondicaoPagamento INT,
    Ativo BIT NOT NULL DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (CidadeId) REFERENCES Cidades(Id) ON DELETE SET NULL, 
    FOREIGN KEY (IdCondicaoPagamento) REFERENCES CondicoesPagamento(Id) ON DELETE SET NULL
);


-- Tabela de Transportadoras
CREATE TABLE Transportadoras (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Transportadora VARCHAR(100) NOT NULL,
    CpfCnpj VARCHAR(18) UNIQUE NOT NULL,
    Telefone VARCHAR(20),
    Email VARCHAR(100),
    Endereco VARCHAR(200),
    Cep VARCHAR(10),
    Tipo VARCHAR(10) NOT NULL,
    Bairro VARCHAR(100),
    NumeroEndereco INT,
    Complemento VARCHAR(200),
    CidadeId INT, 
    InscricaoEstadual VARCHAR(30),
    InscricaoEstadualSubtrib VARCHAR(30),
    IdCondicaoPagamento INT,
    Ativo BIT NOT NULL DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (CidadeId) REFERENCES Cidades(Id) ON DELETE SET NULL, 
    FOREIGN KEY (IdCondicaoPagamento) REFERENCES CondicoesPagamento(Id) ON DELETE SET NULL
);


-- TABELA: Marcas
CREATE TABLE Marcas (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Marca VARCHAR(100) NOT NULL,
    Ativo BIT NOT NULL DEFAULT 1,
    DataCadastro DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);


-- TABELA: Grupos
CREATE TABLE Grupos (
    Id INT PRIMARY KEY AUTO_INCREMENT,
    Grupo VARCHAR(100),
    Descricao VARCHAR(255),
    IpImpressora VARCHAR(50),
    Ativo BIT DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- TABELA: Produtos
CREATE TABLE Produtos (
    Id INT AUTO_INCREMENT PRIMARY KEY,
    Produto VARCHAR(100) NOT NULL,
    Descricao VARCHAR(255),
    Preco DECIMAL(10,2) NOT NULL,
    Estoque INT DEFAULT 0,
    IdMarca INT,
    GrupoId INT NOT NULL,
    TempoPreparo INT,
    Ingredientes VARCHAR(255),
    Ativo BIT NOT NULL DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (IdMarca) REFERENCES Marcas(Id) ON DELETE SET NULL,
    FOREIGN KEY (GrupoId) REFERENCES Grupos(Id)
);

-- Tabela de Veículos 
CREATE TABLE Veiculos (
    Id INT PRIMARY KEY AUTO_INCREMENT,
    TransportadoraId INT NOT NULL,
    IdMarca INT,
    Placa VARCHAR(10) UNIQUE NOT NULL,
    Modelo VARCHAR(50),
    AnoFabricacao INT,
    CapacidadeCargaKg DECIMAL(10,2),
    Ativo BIT DEFAULT 1,
    DataCadastro DATETIME DEFAULT CURRENT_TIMESTAMP,
    DataAlteracao DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (TransportadoraId) REFERENCES Transportadoras(Id),
    FOREIGN KEY (IdMarca) REFERENCES Marcas(Id)
);